/*
 * W2812B.c
 *
 *  Created on: Oct 6, 2022
 *      Author: owl_hor
 */

#include "W2812B.h"

const uint8_t W2812LUT[] = { 0b10010010, 0b01001001, 0b00100100, 0b10010010,
		0b01001001, 0b00100110, 0b10010010, 0b01001001, 0b00110100, 0b10010010,
		0b01001001, 0b00110110, 0b10010010, 0b01001001, 0b10100100, 0b10010010,
		0b01001001, 0b10100110, 0b10010010, 0b01001001, 0b10110100, 0b10010010,
		0b01001001, 0b10110110, 0b10010010, 0b01001101, 0b00100100, 0b10010010,
		0b01001101, 0b00100110, 0b10010010, 0b01001101, 0b00110100, 0b10010010,
		0b01001101, 0b00110110, 0b10010010, 0b01001101, 0b10100100, 0b10010010,
		0b01001101, 0b10100110, 0b10010010, 0b01001101, 0b10110100, 0b10010010,
		0b01001101, 0b10110110, 0b10010010, 0b01101001, 0b00100100, 0b10010010,
		0b01101001, 0b00100110, 0b10010010, 0b01101001, 0b00110100, 0b10010010,
		0b01101001, 0b00110110, 0b10010010, 0b01101001, 0b10100100, 0b10010010,
		0b01101001, 0b10100110, 0b10010010, 0b01101001, 0b10110100, 0b10010010,
		0b01101001, 0b10110110, 0b10010010, 0b01101101, 0b00100100, 0b10010010,
		0b01101101, 0b00100110, 0b10010010, 0b01101101, 0b00110100, 0b10010010,
		0b01101101, 0b00110110, 0b10010010, 0b01101101, 0b10100100, 0b10010010,
		0b01101101, 0b10100110, 0b10010010, 0b01101101, 0b10110100, 0b10010010,
		0b01101101, 0b10110110, 0b10010011, 0b01001001, 0b00100100, 0b10010011,
		0b01001001, 0b00100110, 0b10010011, 0b01001001, 0b00110100, 0b10010011,
		0b01001001, 0b00110110, 0b10010011, 0b01001001, 0b10100100, 0b10010011,
		0b01001001, 0b10100110, 0b10010011, 0b01001001, 0b10110100, 0b10010011,
		0b01001001, 0b10110110, 0b10010011, 0b01001101, 0b00100100, 0b10010011,
		0b01001101, 0b00100110, 0b10010011, 0b01001101, 0b00110100, 0b10010011,
		0b01001101, 0b00110110, 0b10010011, 0b01001101, 0b10100100, 0b10010011,
		0b01001101, 0b10100110, 0b10010011, 0b01001101, 0b10110100, 0b10010011,
		0b01001101, 0b10110110, 0b10010011, 0b01101001, 0b00100100, 0b10010011,
		0b01101001, 0b00100110, 0b10010011, 0b01101001, 0b00110100, 0b10010011,
		0b01101001, 0b00110110, 0b10010011, 0b01101001, 0b10100100, 0b10010011,
		0b01101001, 0b10100110, 0b10010011, 0b01101001, 0b10110100, 0b10010011,
		0b01101001, 0b10110110, 0b10010011, 0b01101101, 0b00100100, 0b10010011,
		0b01101101, 0b00100110, 0b10010011, 0b01101101, 0b00110100, 0b10010011,
		0b01101101, 0b00110110, 0b10010011, 0b01101101, 0b10100100, 0b10010011,
		0b01101101, 0b10100110, 0b10010011, 0b01101101, 0b10110100, 0b10010011,
		0b01101101, 0b10110110, 0b10011010, 0b01001001, 0b00100100, 0b10011010,
		0b01001001, 0b00100110, 0b10011010, 0b01001001, 0b00110100, 0b10011010,
		0b01001001, 0b00110110, 0b10011010, 0b01001001, 0b10100100, 0b10011010,
		0b01001001, 0b10100110, 0b10011010, 0b01001001, 0b10110100, 0b10011010,
		0b01001001, 0b10110110, 0b10011010, 0b01001101, 0b00100100, 0b10011010,
		0b01001101, 0b00100110, 0b10011010, 0b01001101, 0b00110100, 0b10011010,
		0b01001101, 0b00110110, 0b10011010, 0b01001101, 0b10100100, 0b10011010,
		0b01001101, 0b10100110, 0b10011010, 0b01001101, 0b10110100, 0b10011010,
		0b01001101, 0b10110110, 0b10011010, 0b01101001, 0b00100100, 0b10011010,
		0b01101001, 0b00100110, 0b10011010, 0b01101001, 0b00110100, 0b10011010,
		0b01101001, 0b00110110, 0b10011010, 0b01101001, 0b10100100, 0b10011010,
		0b01101001, 0b10100110, 0b10011010, 0b01101001, 0b10110100, 0b10011010,
		0b01101001, 0b10110110, 0b10011010, 0b01101101, 0b00100100, 0b10011010,
		0b01101101, 0b00100110, 0b10011010, 0b01101101, 0b00110100, 0b10011010,
		0b01101101, 0b00110110, 0b10011010, 0b01101101, 0b10100100, 0b10011010,
		0b01101101, 0b10100110, 0b10011010, 0b01101101, 0b10110100, 0b10011010,
		0b01101101, 0b10110110, 0b10011011, 0b01001001, 0b00100100, 0b10011011,
		0b01001001, 0b00100110, 0b10011011, 0b01001001, 0b00110100, 0b10011011,
		0b01001001, 0b00110110, 0b10011011, 0b01001001, 0b10100100, 0b10011011,
		0b01001001, 0b10100110, 0b10011011, 0b01001001, 0b10110100, 0b10011011,
		0b01001001, 0b10110110, 0b10011011, 0b01001101, 0b00100100, 0b10011011,
		0b01001101, 0b00100110, 0b10011011, 0b01001101, 0b00110100, 0b10011011,
		0b01001101, 0b00110110, 0b10011011, 0b01001101, 0b10100100, 0b10011011,
		0b01001101, 0b10100110, 0b10011011, 0b01001101, 0b10110100, 0b10011011,
		0b01001101, 0b10110110, 0b10011011, 0b01101001, 0b00100100, 0b10011011,
		0b01101001, 0b00100110, 0b10011011, 0b01101001, 0b00110100, 0b10011011,
		0b01101001, 0b00110110, 0b10011011, 0b01101001, 0b10100100, 0b10011011,
		0b01101001, 0b10100110, 0b10011011, 0b01101001, 0b10110100, 0b10011011,
		0b01101001, 0b10110110, 0b10011011, 0b01101101, 0b00100100, 0b10011011,
		0b01101101, 0b00100110, 0b10011011, 0b01101101, 0b00110100, 0b10011011,
		0b01101101, 0b00110110, 0b10011011, 0b01101101, 0b10100100, 0b10011011,
		0b01101101, 0b10100110, 0b10011011, 0b01101101, 0b10110100, 0b10011011,
		0b01101101, 0b10110110, 0b11010010, 0b01001001, 0b00100100, 0b11010010,
		0b01001001, 0b00100110, 0b11010010, 0b01001001, 0b00110100, 0b11010010,
		0b01001001, 0b00110110, 0b11010010, 0b01001001, 0b10100100, 0b11010010,
		0b01001001, 0b10100110, 0b11010010, 0b01001001, 0b10110100, 0b11010010,
		0b01001001, 0b10110110, 0b11010010, 0b01001101, 0b00100100, 0b11010010,
		0b01001101, 0b00100110, 0b11010010, 0b01001101, 0b00110100, 0b11010010,
		0b01001101, 0b00110110, 0b11010010, 0b01001101, 0b10100100, 0b11010010,
		0b01001101, 0b10100110, 0b11010010, 0b01001101, 0b10110100, 0b11010010,
		0b01001101, 0b10110110, 0b11010010, 0b01101001, 0b00100100, 0b11010010,
		0b01101001, 0b00100110, 0b11010010, 0b01101001, 0b00110100, 0b11010010,
		0b01101001, 0b00110110, 0b11010010, 0b01101001, 0b10100100, 0b11010010,
		0b01101001, 0b10100110, 0b11010010, 0b01101001, 0b10110100, 0b11010010,
		0b01101001, 0b10110110, 0b11010010, 0b01101101, 0b00100100, 0b11010010,
		0b01101101, 0b00100110, 0b11010010, 0b01101101, 0b00110100, 0b11010010,
		0b01101101, 0b00110110, 0b11010010, 0b01101101, 0b10100100, 0b11010010,
		0b01101101, 0b10100110, 0b11010010, 0b01101101, 0b10110100, 0b11010010,
		0b01101101, 0b10110110, 0b11010011, 0b01001001, 0b00100100, 0b11010011,
		0b01001001, 0b00100110, 0b11010011, 0b01001001, 0b00110100, 0b11010011,
		0b01001001, 0b00110110, 0b11010011, 0b01001001, 0b10100100, 0b11010011,
		0b01001001, 0b10100110, 0b11010011, 0b01001001, 0b10110100, 0b11010011,
		0b01001001, 0b10110110, 0b11010011, 0b01001101, 0b00100100, 0b11010011,
		0b01001101, 0b00100110, 0b11010011, 0b01001101, 0b00110100, 0b11010011,
		0b01001101, 0b00110110, 0b11010011, 0b01001101, 0b10100100, 0b11010011,
		0b01001101, 0b10100110, 0b11010011, 0b01001101, 0b10110100, 0b11010011,
		0b01001101, 0b10110110, 0b11010011, 0b01101001, 0b00100100, 0b11010011,
		0b01101001, 0b00100110, 0b11010011, 0b01101001, 0b00110100, 0b11010011,
		0b01101001, 0b00110110, 0b11010011, 0b01101001, 0b10100100, 0b11010011,
		0b01101001, 0b10100110, 0b11010011, 0b01101001, 0b10110100, 0b11010011,
		0b01101001, 0b10110110, 0b11010011, 0b01101101, 0b00100100, 0b11010011,
		0b01101101, 0b00100110, 0b11010011, 0b01101101, 0b00110100, 0b11010011,
		0b01101101, 0b00110110, 0b11010011, 0b01101101, 0b10100100, 0b11010011,
		0b01101101, 0b10100110, 0b11010011, 0b01101101, 0b10110100, 0b11010011,
		0b01101101, 0b10110110, 0b11011010, 0b01001001, 0b00100100, 0b11011010,
		0b01001001, 0b00100110, 0b11011010, 0b01001001, 0b00110100, 0b11011010,
		0b01001001, 0b00110110, 0b11011010, 0b01001001, 0b10100100, 0b11011010,
		0b01001001, 0b10100110, 0b11011010, 0b01001001, 0b10110100, 0b11011010,
		0b01001001, 0b10110110, 0b11011010, 0b01001101, 0b00100100, 0b11011010,
		0b01001101, 0b00100110, 0b11011010, 0b01001101, 0b00110100, 0b11011010,
		0b01001101, 0b00110110, 0b11011010, 0b01001101, 0b10100100, 0b11011010,
		0b01001101, 0b10100110, 0b11011010, 0b01001101, 0b10110100, 0b11011010,
		0b01001101, 0b10110110, 0b11011010, 0b01101001, 0b00100100, 0b11011010,
		0b01101001, 0b00100110, 0b11011010, 0b01101001, 0b00110100, 0b11011010,
		0b01101001, 0b00110110, 0b11011010, 0b01101001, 0b10100100, 0b11011010,
		0b01101001, 0b10100110, 0b11011010, 0b01101001, 0b10110100, 0b11011010,
		0b01101001, 0b10110110, 0b11011010, 0b01101101, 0b00100100, 0b11011010,
		0b01101101, 0b00100110, 0b11011010, 0b01101101, 0b00110100, 0b11011010,
		0b01101101, 0b00110110, 0b11011010, 0b01101101, 0b10100100, 0b11011010,
		0b01101101, 0b10100110, 0b11011010, 0b01101101, 0b10110100, 0b11011010,
		0b01101101, 0b10110110, 0b11011011, 0b01001001, 0b00100100, 0b11011011,
		0b01001001, 0b00100110, 0b11011011, 0b01001001, 0b00110100, 0b11011011,
		0b01001001, 0b00110110, 0b11011011, 0b01001001, 0b10100100, 0b11011011,
		0b01001001, 0b10100110, 0b11011011, 0b01001001, 0b10110100, 0b11011011,
		0b01001001, 0b10110110, 0b11011011, 0b01001101, 0b00100100, 0b11011011,
		0b01001101, 0b00100110, 0b11011011, 0b01001101, 0b00110100, 0b11011011,
		0b01001101, 0b00110110, 0b11011011, 0b01001101, 0b10100100, 0b11011011,
		0b01001101, 0b10100110, 0b11011011, 0b01001101, 0b10110100, 0b11011011,
		0b01001101, 0b10110110, 0b11011011, 0b01101001, 0b00100100, 0b11011011,
		0b01101001, 0b00100110, 0b11011011, 0b01101001, 0b00110100, 0b11011011,
		0b01101001, 0b00110110, 0b11011011, 0b01101001, 0b10100100, 0b11011011,
		0b01101001, 0b10100110, 0b11011011, 0b01101001, 0b10110100, 0b11011011,
		0b01101001, 0b10110110, 0b11011011, 0b01101101, 0b00100100, 0b11011011,
		0b01101101, 0b00100110, 0b11011011, 0b01101101, 0b00110100, 0b11011011,
		0b01101101, 0b00110110, 0b11011011, 0b01101101, 0b10100100, 0b11011011,
		0b01101101, 0b10100110, 0b11011011, 0b01101101, 0b10110100, 0b11011011,
		0b01101101, 0b10110110 };

// number of LED piece in module define
#define NUM_LED_WS2812S 8

//// DMA buffer --> Num_LED x 3byte LED protocol x 3 byte RGB
//// +20 --> Gap reset LED for 64 uSec
uint8_t LEDBuffer[NUM_LED_WS2812S*9 + 20];

/// non prototype in .h -> can use in this .c only
void byteToW2812BEncode1(uint8_t dataIn, uint8_t* Array3Output)
{
	//// Array Copy[Big LUT] in assembly
	memcpy(Array3Output,&W2812LUT[dataIn*3],3);
}

/// non prototype in .h -> can use in this .c only
//// Method 2 -> Calculate
void byteToW2812BEncode2(uint8_t dataIn, uint8_t* Array3Output)
{
	//// 100 100 100 100 100 100 100 100; //split 1 byteLED(8bit) -> 1ByteSPI(24bit)
	Array3Output[0] = 0b10010010;
	Array3Output[1] = 0b01001001;
	Array3Output[2] = 0b00100100;


	Array3Output[0] |= (((dataIn >> 7) & 0x1) << 6)
			| (((dataIn >> 6) & 0x1) << 3) | (((dataIn >> 5) & 0x1));

	Array3Output[1] |= (((dataIn >> 4) & 0x1) << 5)
					| (((dataIn >> 3) & 0x1) << 2);

	Array3Output[2] |=(((dataIn >> 2) & 0x1) << 7)
					| (((dataIn >> 1) & 0x1) << 4) | (((dataIn ) & 0x1) << 1);

}

void W2812B_Init(SPI_HandleTypeDef *hspi)
{
	HAL_SPI_Transmit_DMA(hspi,LEDBuffer,NUM_LED_WS2812S  * 9 + 20);
}

void W2812B_UpdateData(W2812BStructure *input)
{
	for(int i = 0;i<NUM_LED_WS2812S;i++)
	{
		byteToW2812BEncode1(input[i].G,&LEDBuffer[20+i*9]);
		byteToW2812BEncode1(input[i].R,&LEDBuffer[20+i*9+3]);
		byteToW2812BEncode1(input[i].B,&LEDBuffer[20+i*9+6]);
	}
}
void HToRGB(int h,W2812BStructure *input)
{
	uint8_t mode= h/256;
	uint8_t state = h%256;

	switch (mode) {
	case 0:
		input->B = 0;
		input->G = state;
		input->R = 255;
		break;
	case 1:
		input->B = 0;
		input->G = 255;
		input->R = 255-state;
		break;
	case 2:
		input->B = state;
		input->G = 255;
		input->R = 0;
		break;
	case 3:
		input->B = 255;
		input->G = 255-state;
		input->R = 0;
		break;
	case 4:
		input->B = 255;
		input->G = 0;
		input->R = state;
		break;
	default:
	case 5:
		input->B = 255-state;
		input->G = 0;
		input->R = 255;
		break;


	}
}

